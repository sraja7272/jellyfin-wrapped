# Enable output filtering
AddOutputFilterByType SUBSTITUTE text/html

# Enable rewrite engine for SPA routing
RewriteEngine On

# If the requested resource doesn't exist as a file or directory,
# serve index.html instead (for client-side routing)
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} !-f
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} !-d
RewriteRule ^ /index.html [L]

# Define environment variable substitution
<Location />
    # Only perform substitution if environment variables are set
    <If "-n env('BACKEND_URL')">
        Substitute "s|<head>|<head><script>window.ENV = { BACKEND_URL: '${BACKEND_URL}', JELLYFIN_SERVER_URL: '${JELLYFIN_SERVER_URL}' };</script>|ni"
    </If>
</Location>
